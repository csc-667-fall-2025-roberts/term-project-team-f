import{l as h}from"../assets/index-Ds9AOPLi.js";const f=(t=0)=>`chat:${t}:message`,p=(t=0)=>`chat:${t}:listing`,c=h(),n=document.querySelector("#message-listing"),o=document.querySelector("#messsage-submit input"),d=document.querySelector("#messsage-submit button");if(!(!n||!o||!d)){let t=!0,l=!1;const i=(e,s,u)=>{t&&(n.innerHTML="",t=!1);const r=document.createElement("div");r.className="chat-message";const g=new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});r.innerHTML=`
      <div class="chat-message-content">
        <div class="chat-message-author">${e}</div>
        <span>${u}</span>
        <span style="font-size: 0.75rem; color: var(--color-gray-500); margin-left: 0.5rem;">${g}</span>
      </div>
    `,n.appendChild(r),n.scrollTop=n.scrollHeight},a=typeof window.GAME_ID<"u"?window.GAME_ID:0;c.emit("joinGameRoom",a),l||(l=!0,c.on(p(a),({messages:e})=>{e.forEach(s=>{i(s.username,s.created_at,s.message)})}),c.on(f(a),e=>{i(e.username,e.created_at,e.message)})),fetch(`/chat/${a}`).then(e=>{if(!e.ok)throw new Error(`Failed to load messages: ${e.status}`);return e.json()}).then(e=>{e.messages&&Array.isArray(e.messages)&&e.messages.forEach(s=>{i(s.username,s.created_at,s.message)})}).catch(e=>console.error("Failed to load messages:",e));const m=()=>{const e=o.value.trim();e.length>0&&(fetch(`/chat/${a}`,{method:"POST",body:JSON.stringify({message:e}),credentials:"include",headers:{"Content-Type":"application/json"}}).then(s=>{s.ok||console.error("Failed to send message:",s.status)}).catch(s=>{console.error("Error sending message:",s)}),o.value="")};d.addEventListener("click",e=>{e.preventDefault(),m()}),o.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),m())})}
//# sourceMappingURL=chat.js.map
